<component prefix="zodb_pgjsonb.config">

  <import package="ZODB"/>

  <sectiontype name="pgjsonb" implements="ZODB.storage"
      datatype=".PGJsonbStorageFactory">

    <key name="dsn" required="yes">
      <description>
        PostgreSQL connection string (libpq format).
        Example: dbname=zodb user=zodb password=zodb host=localhost port=5433
      </description>
    </key>

    <key name="name" default="pgjsonb">
      <description>Storage name (used in sort keys).</description>
    </key>

    <key name="history-preserving" datatype="boolean" default="false">
      <description>Enable history-preserving mode.</description>
    </key>

    <key name="blob-temp-dir" required="no">
      <description>
        Directory for temporary blob files. Auto-created if omitted.
      </description>
    </key>

    <key name="cache-local-mb" datatype="integer" default="16">
      <description>
        Size of the per-instance object cache in megabytes.
        Caches load() results (pickle bytes) to avoid repeated
        PostgreSQL round-trips and JSONB transcoding. Set to 0
        to disable. Default: 16.
      </description>
    </key>

    <key name="pool-size" datatype="integer" default="1">
      <description>
        Minimum number of connections in the instance connection pool.
        Set to 0 for on-demand creation. Default: 1.
      </description>
    </key>

    <key name="pool-max-size" datatype="integer" default="10">
      <description>
        Maximum number of connections in the instance connection pool.
        Default: 10.
      </description>
    </key>

    <key name="pool-timeout" datatype="float" default="30.0">
      <description>
        Connection pool acquisition timeout in seconds.
        Raises StorageError if a connection cannot be acquired within
        this time.
      </description>
    </key>

    <!-- S3 tiered blob storage (optional, requires zodb-pgjsonb[s3]) -->

    <key name="blob-threshold" datatype="byte-size" default="1MB">
      <description>
        Blobs larger than this are stored in S3 (if configured).
        Blobs smaller than this stay in PostgreSQL bytea.
        Set to 0 to send all blobs to S3. Default: 1MB.
        Requires s3-bucket-name to be set.
      </description>
    </key>

    <key name="s3-bucket-name" required="no">
      <description>
        S3 bucket name for large blob storage.
        If omitted, all blobs are stored in PostgreSQL bytea.
      </description>
    </key>

    <key name="s3-prefix" default="">
      <description>S3 key prefix for namespace isolation.</description>
    </key>

    <key name="s3-endpoint-url" required="no">
      <description>
        S3 endpoint URL (for MinIO, Ceph, or other S3-compatible stores).
      </description>
    </key>

    <key name="s3-region" required="no">
      <description>AWS region name.</description>
    </key>

    <key name="s3-access-key" required="no">
      <description>
        AWS access key ID. Uses boto3 credential chain if omitted.
      </description>
    </key>

    <key name="s3-secret-key" required="no">
      <description>
        AWS secret access key. Uses boto3 credential chain if omitted.
      </description>
    </key>

    <key name="s3-use-ssl" datatype="boolean" default="true">
      <description>Enable SSL for S3 connections. Default: true.</description>
    </key>

    <key name="blob-cache-dir" required="no">
      <description>
        Local cache directory for S3 blobs. Uses blob-temp-dir if omitted.
        Recommended for production to avoid repeated S3 downloads.
      </description>
    </key>

    <key name="blob-cache-size" datatype="byte-size" default="1GB">
      <description>
        Maximum size of local blob cache. Default: 1GB.
      </description>
    </key>

  </sectiontype>

</component>
